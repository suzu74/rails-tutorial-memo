# Rails tutorial memo

## 20200625

### 第1章 ゼロからデプロイまで

* Railsだけでしか使えない基礎的な知識に基づくのではなく、ウェブ開発の基礎を学ぶことを重点とした高度な技術について学ぶ。
* 技術的に困難な課題を解決するために必要なのはスキルは2つのスキル（熟練）が必要
    * ハードスキル (操作方法などの定型化しやすいスキル) 
    * ソフトスキル (デバッグなどの定型化しにくいスキル)
* 技術は知っていればよいというものではなく、エラーメッセージを検索して調べたりなど見極める力も必要。
    * デバッグとかをつい怠ってしまうと感じている。`Rails.logger`や`◯◯.inspect`をもっと使うことも意識する。 
* 改めてRails tutorialで学べることが多くて驚いている。
    * MVCやREST、ジェネレータ、マイグレーション、ルーティング、ERBなどなど、今まではなんとなくで理解していたものが多いので、言葉で説明できるようにしたい。

#### 1.1 はじめに

* Rubyが柔軟性があるからこそ、Railsが簡潔で使いやすくなっている。
    * DSL (ドメイン固有言語) ???　⇨　https://www.jetbrains.com/ja-jp/mps/concepts/domain-specific-languages/
* Railsは最新のWebテクノロジーやフレームワーク設計に素早く適応している。だからこそ進化が早い。
* 多様なコミュニティがあるから、エラーに遭遇すると検索すれば関連する情報がすぐ見つかる。


##### 1.1.1 前提知識

* Rails チュートリアルでもProgateが紹介されているとは驚いた。
* 演習
    * Ruby gemはどのWebサイトにありますか？
        * https://rubygems.org/
    * 現時点でのRailsの最新バージョンはいくつですか？
        * Ruby on Rails 6.0.3
    * Ruby on Railsはこれまでに何回ダウンロードされたでしょうか？
        * すぐにはみつからず、、、。

##### 1.1.2 この本における取り決め

* エラーメッセージをGoogleで検索することは、実際の現場でも使われている基本的なテクニック
    * 何かわからなければ随時調べる。

#### 1.2 さっそく動かす

* ここからRubyなどのインストールを開始。久しぶりに開発環境を整える。
* 一番最初にチュートリアルをやったときはAWS Cloud9(クラウドIDE)だったのがなんだか懐かしい、、、、
    * 無事rails newができた、、、

## 20200626

##### 1.2.1 開発環境

* Cloud9は使わないので割愛

##### 1.2.1 Railsをインストールする

* インストール済み

#### 1.3 最初のアプリケーション

* Webフレームワークではディレクトリとファイルの構造は標準化されている。そのメリットがファイル/ディレクトリ構造が標準化されていることで他の開発者の書いたRailsのコードが読みやすくなること。
* rails new実行！

##### 1.3.1 Bundler

* gem 'uglifier', '>= 1.3.0' だったら、1.3.0以上なら最新をインストール。
* gem 'coffee-rails', '~> 4.0.0'だったら、4.0.0より大きく4.1より小さい場合にインストール。

##### 1.3.2 rails server

* 演習
    * Rubyのバージョンはいくつになっていますか?
        *  2.7.1
    * Railsのバージョンはいくつになっていますか?
        * 5.2.4.3

##### 1.3.3 Model-View-Controller (MVC)

* RailsはMVC (model-view-controller) というアーキテクチャパターンを採用している。MVCでは、アプリケーション内のデータ（ユーザー情報など）と、データを表示するコードを分離している。
* Model
    * アプリケーションが扱うデータ
* View
    * ユーザーへの出力処理
* Controller
    * 必要な処理をModelやViewに伝える
* 上記3つがそれぞれ独立して互いに連携しているのが特徴。

#### 1.3.4 Hello, world!

* 演習まで完了

#### 1.4 Gitによるバージョン管理

* 仕事をする上では欠かせないGitについてスタート

###### 1.4.1 インストールとセットアップ

* Gitにおけるコミットは、あくまでローカルマシン上での操作であること。
	* git pushコマンドで変更をリモートリポジトリにプッシュすることでリモートへ反映。

###### 1.4.2 Gitのメリット

* 読了

###### 1.4.3 Bitbucket

* GitHubで行うので軽く目を通すのみ。
* GitHubにてpush完了

###### 1.4.4 ブランチ、編集、コミット、マージ

* チュートリアルでは出てきたgit commandは業務で毎日使うコマンドが多く困ることはなかった。
    * しかし git branch -D　と　git branch -dなどの違いがわからない。(ここら辺は都度調べれば良さそう)
        * 個人的に一番いまだにわからないのが、fast-forwardとnon-fast-forward。調べたりしているがいまいち理解ができず苦手。
        * cherry-pickやrevertも好きではない、、、。

####　1.5 デプロイする

* Phusion Passenger???
* 一通りのデプロイ環境を提供するEngine YardやRails Machine???
* クラウドサービスを提供するEngine Yard CloudやHeroku??
    * Heroku以外馴染みのない言葉が多かった。

## 20200627

##### 1.5.1 Herokuのセットアップ

* herokuのコマンドが約一年ぶりで忘れていた。（現状頻繁に使うことはないので必要に応じて調べれば良さそう）
    * heroku create (Herokuサーバーにサンプルアプリケーションの実行場所を作成)
    * heroku keys:add(SSHキー)
     * SSHとかについて理解が浅い。何度か調べてはいるが口で説明ができない。

##### 1.5.2 Herokuにデプロイする (1)

* git push heroku master (Gitを使ってHerokuにリポジトリをプッシュ)
    * fetch とか mergeの理解が浅い。
        * 上記2つを同時にやるのがpullなのは理解している。。。。

##### 1.5.3 Herokuにデプロイする (2)

* 無事にデプロイ完了。
    * https://polar-falls-51413.herokuapp.com/

##### 1.5.4 Herokuコマンド

* heroku rename 新しい名前
* 演習
    * Herokuアプリのログを表示するコマンドは？
        * heroku logs

#### 1.6 最後に

* この賞で学んだこと.
    * 開発環境のセットアップやバージョン管理、本番環境へのデプロイの方法。

##### 1.6.1 本章のまとめ

 * この章で理解が不十分だと感じたこと。
    * MVCへの理解。概要はわかるが言葉では説明できない。
    * RESTはMVCよりも理解が浅い。
    * gitコマンドの理解度。
        * チュートリアルに出るコマンドは問題なく使える。
            * しかしcherry pick や revert fast-forwardやnon-fast-forward、fetch mergeの各コマンドの理解が浅い。
    * SSHあたりのセキュリティ面についての理解も自信ない。
        * SSHについては「これから学ぶmacOSターミナル」で概要は読んではいる。
            * 暗号化された通信が可能で安全なリモートログインを可能にするものであると認識している。
    * Bundlerについても詳しく知らずに使っている。
        * とりあえずbundle installやbundle updateを使っていた。

## 20200628

### 第2章 Toyアプリケーション

* scaffoldを通じてRailsアプリの構造とRailsで推奨されているRESTアーキテクチャについて学ぶ
    * RESTについて言葉で説明できないのでこの章でしっかり身につける。

#### 2.1 アプリケーションの計画

* ここは第1章でやったこととほぼ同じ。
    * routeとcontrollerを変えて、アクションの追加。

* 改めて最初にgit push する流れがイマイチなので復習

* git init　(Gitリポジトリの作成)
* git add ファイル名
* git commit -m "メッセージ"
* git remote add origin URL名
* git remote -v 上記で登録された内容の確認
* git push -u origin master
    * -uって何だろう？
        * 成功時に上流ブランチとして設定される。
            * 上流ブランチ（Upstream branch）」とは、あるローカルブランチが、履歴を追跡するように設定したリモートブランチの事を指します
                * そのブランチ上で発生したすべての更新をそのまま取り込む事を追跡するという。

* Webアプリを作る際は構造を表すためのデータモデルを最初に作成するのが通常の流れ。

##### 2.1.1 ユーザーのモデル設計

* 読了

##### 2.1.2 マイクロポストのモデル設計

* ユーザーと関連付ける必要があるので、マイクロポストの投稿者を記録するためのuser_idも追加

#### 2.2 Usersリソース

* Rails 5以前のバージョンでは、db:migrateコマンドはrailsコマンドではなくrakeコマンドが使われていました。
    * Rakeってものについてあまり知らない。

* Rails 4以前のアプリケーションでは、rakeコマンドのバージョンをGemfileで定義しているため、Bundlerのbundler execコマンドを通して実行する必要。
    * bundle exec rake db:migrate 
        * このbundle execについての理解が浅い。

##### 2.1.2 ユーザーページを探検する

* 実際にUsersリソースの挙動の確認完了。

##### 2.2.2 MVCの挙動

* RESTとは、アーキテクチャのスタイルの1つ
* RailsにおけるRESTとは？
    * アプリケーションを構成するコンポーネント (ユーザーなど) を「リソース」としてモデル化することを指す
        * リソースは、リレーショナルデータベースの作成/取得/更新/削除 (CRUD) 操作と、4つの基本的なHTTP requestメソッド (POST/GET/PATCH/DELETE) の両方に対応しています。
        * RESTfulなスタイルを採用することで、作成すべきコントローラやアクションの決定が楽になるのがメリット。

* Active Recordのおかげで便利になって、User.allやfirstを用いて簡単に操作できることは理解しているがその中身についてはよくわからない。

##### 2.2.3 Usersリソースの欠点

* 現状の状態だとvalidationなどもなく欠点が多い。

#### 2.3 Micropostsリソース

* 読了

##### 2.3.1 マイクロポストを探検する

* 実際にMicropostsリソースの挙動の確認完了。

##### 2.3.2 マイクロポストをマイクロにする

* validationの追加。
    * 基本的なvalidationに関しては理解している。

##### 2.3.3 ユーザーはたくさんマイクロポストを持っている

* 1人のユーザーに対して複数のマイクロポストがあるから、has_many
*  1つのマイクロポストは1人のユーザーにのみ属するから、belongs_to
    * 上記の関連付けの結果、User.first.micropostsなどのメソッドが使えるようになる。
        * 関連付けの結果使えるようになるメソッドの理解が浅い。(基本的なbuild等のみ)

##### 2.3.4 継承の階層

* モデルはActionController::Baseを継承することで、モデルオブジェクトはデータベースにアクセスできるようになる。
* コントローラーも同様にActionController::Baseを継承している。
    * 上記のようにActiveRecord::BaseやActionController::Baseを継承していることで、便利になっていることはわかっているが、そもそもActionController::BaseやActionController::Baseについてはよくわかっていない。


##### 2.3.5 アプリケーションをデプロイする

* デプロイ完了

#### 2.4 最後に

* MVCモデルやRESTアーキテクチャに触れることができた。

##### 2.4.1 本章のまとめ

* RailsのRESTには、標準的なURLセットと、データモデルとやりとりするためのコントローラアクションが含まれている。

* この章で理解が不十分だと感じたこと
    * Railの思想についての理解（RESTについてなど）
    * データモデル同士を関連付け
        * 関連付けを行うことで使用できるようになるメソッドへの理解が甘い。
            * 上記に関しては実際にコンソールを叩いて覚えて行きたい。
    * ActiveRecordやActionControllerへの理解。
        * 上記があることで、Railsが便利になっていることは何となく理解はしているが、深い知識がまだまだ足りない。

### 第3章 ほぼ静的なページの作成

* 静的なページの作成と自動テストのコードを書いていく。
* テストを書くメリット。
    * リファクタリングなどを行う時にテストが通ることを確認しながらできる点。

#### 3.1 セットアップ

* bundle install --without production
    * 上記のオプションをつけることで、production環境でしか使わないgemはインストールしないようにしておくことができる。
        * 一回このオプションをつけると次回以降はこのオプションは暗黙的に実行される。

* bundle updateやbundle installの明確な違いがわからない。

* 今後こまめにHerokuへデプロイする。
    * こまめにやることで、エラーなども早めに検知することができる。

#### 3.2 静的ページ

* 読了

##### 3.2.1 静的なページの生成

* rails generateってコマンドも便利だと感じていたが細かい内容についてはよくわかっていない。
    * rails generate することでいい感じに必要な複数のファイルなどを作成してくれるものだと認識して深くは理解していない。（所謂便利コマンド）

* 改めてのメモ、、、コントローラーは複数形、モデルは単数形
    * ex) usersテーブル　userモデル

    * Rubyはクラス名にキャメルケースを使う慣習
    * さらにファイル名をスネークケースで記述する慣習がある

* rails gを間違えた時の操作について理解してなかったのでメモ
    * rails generate controller StaticPages home helpを間違えたため消したい時は、、、
        * rails destroy  controller StaticPages home helpを行えはrails gで作られたファイルも削除される。
    * モデルの場合も同様で、rails generate model User name:string email:stringを消す場合は、
        *  rails destroy model User(モデル名以外は引き数はいらない)

* ページ表示までの流れ 
    * /static_pages/homeというURLにアクセスする
        * StaticPagesコントローラを参照
            * homeアクションに記述されているコード
                * そのアクションに対応するビュー出力
                    * アクション名とviewファイルの名前は対応している

* 演習　
    * 作成 rails generate controller Foo bar baz 
    * 削除 rails  destroy controller Foo bar baz

##### 3.2.2 静的なページの調整

* Viewの微調整完了

#### 3.3 テストから始める

* テスト駆動開発 (TDD)
    * ます「正しいコードがないと失敗するテスト」を書く
        * 次に正しいコードを書いてそのテストがパスするようにする。

* テストのメリットを改めて再確認する
    * 以前のバグが再発したり機能の追加/変更に副作用が生じたりすることを防止できる。
    * コードを安全にリファクタリングできる
    * アプリケーションの設計やシステムの他の部分とのインターフェイスを決めるときにも役に立つ

##### 3.3.1 最初のテスト

*  minitestの文法はあまりわからないが、RSpecで勉強したのでコードは読めそう。

##### 3.3.2 Red

* テスト駆動開発のサイクルの最初のステップは「失敗するテストを最初に書く」
    * 次にアプリケーションのコードを書いて成功させる (パスさせる）
        *  (必要なら)リファクタリングする

##### 3.3.3 Grveen

* 実際にTDDを実行。
* 実際の開発でも習慣化できると良さそう。

##### 3.3.4 Refactor

* テストをきちんと書いているからこそリファクタリングがしやすくなる。
    * テストがあるとリファクタリングした際などの他への副作用などを確認できるからである。

#### 3.4 少しだけ動的なページ

* 読了

##### 3.4.1 タイトルをテストする (Red)

* assert_selectメソッドでは、特定のHTMLタグが存在するかどうかをテスト

##### 3.4.2 タイトルを追加する (Green)

* テストが通ることを確認

##### 3.4.3 レイアウトと埋め込みRuby (Refactor)

* 同じコードを繰り返すことはDRYの原則に反する。
    * もし重複するコードを見つけたら、共通化できないか考える癖をつける。

* <%= yield %>の部分に各ページの内容をレイアウトに挿入
    * yieldは確かprocだったような、、、
        * procはいまだによくわからない。

* Asset Pipelineの仕組みについても理解が浅い、（第5章で出てくるのでそこで深める）
* CSRFなどのセキュリテイに関してもよくわかっていない。

* 演習
    * Contactページが存在することを確認するテストを書く　⇨　テストが落ちることを確認。
        * route　⇨　controller　⇨　view　の順番で修正し無事にテストが通ることを確認。

* このぐらいの小規模のものであれば特に困ることなくできそう。
    * おそらく去年はここらへんもビクビクしながらやっていたと思う、、、、笑

##### 3.4.4 ルーティングの設定

* routeを追加することによるroot_pathなどのヘルパーメソッドを確認するなら、rails／infoが便利そう？

#### 3.5 最後に
　
* https://cryptic-river-78728.herokuapp.com/ へデプロイ完了。

##### 3.5.1 本章のまとめ

* 理解が不十分と感じた点
    * yieldについての理解
        * procで出てきたのは覚えている。
    * Asset Pipelineなどの仕組み

#### 3.6 高度なセットアップ

* 読了

##### 3.6.1 minitest reporters

* 読了

##### 3.6.2 Guardによるテストの自動化

* コラム 3.4. Unixのプロセス
    * Unixなどについてのよくわかっていない。
        * ps aux などのコマンドもあまり使ったことがないので理解が追いついていない。

### 第4章 Rails風味のRuby

* 読了

#### 4.1 動機

* 読了

##### 4.1.1 組み込みヘルパー

* Railsの組み込み関数stylesheet_link_tagにもRubyの4つの概念が存在
    * Railsの組み込み関数
    * カッコを使わないメソッド呼び出し
    * シンボル
    * ハッシュ

##### 4.1.2 カスタムヘルパー

* 組み込み関数は自分でも作ることができ、それをカスタムヘルパーと呼ぶ

* helperに書くべきもの、draperに書くべきものなどの違いがわからない。
    * controllerやmodelが肥大化するのを避けるためには、適切な箇所にメソッドを書くことが不可欠。
        * しかしcontroller、model、helper、draper各所に適切に書くべきものの理解が曖昧。

#### 4.2 文字列とメソッド

* そういえばちょっとしたRubyの挙動を確認するときは、irbとかpryとか使っているが、両者の違いがわかっていない。

* Rubyの日本語の有名なリファレンス ⇨ https://docs.ruby-lang.org/ja/
    * あまりこういったリファレンスを今まで使ってなかった。

##### 4.2.1 コメント

* 読了

##### 4.2.2 文字列

* 今までは意識してなかったが、コンソールは入力したそれぞれの行を評価した結果を表示し、文字列リテラルの場合には文字列自身が表示される。

* putsの戻り値はnil
* シングルクォートは、入力した文字をエスケープせずに「そのまま」保持するときに便利。\n、\tなど

## 20200630

##### 4.2.3 オブジェクトとメッセージ受け渡し

* オブジェクトとはいつでもメッセージに応答するもの
* そもそもオブジェクト（指向）に対する理解が浅い。

##### 4.2.4 メソッドの定義

* 引数にデフォルト値を含めてると、変数に引数を渡すことも渡さないこともできます。
* Rubyのメソッドには「暗黙の戻り値がある」
    * メソッド内で最後に評価された式の値が自動的に返されること

##### 4.2.5 titleヘルパー、再び

* モジュールは、関連したメソッドをまとめる方法の１つ
    * includeでモジュールを読み込むことができる

* Rubyではincludeが必要だが、Railsでは自動的にヘルパーモジュールを読み込んでくれるので、include行をわざわざ書く必要がない。
    * ここら辺のRailsが裏側で行なってくれている便利な機能についてイマイチ理解できていない。
        * full_titleメソッドは全てのviewで使用可能

#### 4.3 他のデータ構造

* 読了

## 20200630

##### 4.3.1 配列と範囲演算子

* 配列 (array) は、特定の順序を持つ要素のリスト

* push(<<)は!がないが破壊的メソッド

* 文字列に対しても範囲オブジェクトが
    * ('a'..'e').to_a ⇨　 ["a", "b", "c", "d", "e"]

##### 4.3.2 ブロック

* ブロックは、Rubyの極めて強力な機能であり、かつわかりにくい機能
    * もっともよく使うメソッドの一つであるため、理解を深めると武器になりそう。

* Ruby共通の慣習
    * 短い1行のブロックには波カッコ使う
    * 長い1行や複数行のブロックにはdo..endを使う。
        * 上記2つは結合のレベル？に違いなどがあるらしいが、細かいことなので割愛。

*  `%w[A B C].map(&:downcase)`のような書き方も一般的。
    * 最低限読めるようにはなっておかないといけない。

##### 4.3.3 ハッシュとシンボル

* インデックスとして整数値以外のものも使える点が配列と異なる

* ハッシュは配列と似ている。
    * 1つの重要な違いとして、ハッシュでは要素の「並び順」が保証されないという点

* シンボルは、Ruby以外ではごく一部の言語にしか採用されていない特殊なデータ形式
    * Rubyからメインにプログラミングに触れたので。シンボルに対しては馴染みがあったつもりだが、シンボルは多くの言語では採用されていないとは、、、

* ハッシュの中のハッシュ
    * ちょっと苦手かも、、、配列の配列はわかっているし、それと基本的な考え方は同じ、、、だと思う。

```
 params = {}        # 'params' というハッシュを定義する ('parameters' の略)。
=> {}
 params[:user] = { name: "Michael", email: "michel@example.com" }
=> {:name=>"Michael", :email=>"michel@example.com"}
 params
=> {:user=>{:name=>"Michael", :email=>"michel@example.com"}}
 params[:user][:email]
=> "mhartl@example.com"
```

* ハッシュもeachメソッドを使える。
    * ブロックの変数はキーと値の2つになる。

##### 4.3.4 CSS、再び

* 以下のコードについて読む。

```
stylesheet_link_tag 'application', media: 'all',
                                   'data-turbolinks-track': 'reload'
```

* そもそも意識はしてなかったが、`stylesheet_link_tag`はメソッド
    * 以前教わった、`validates`もメソッド。
* 上記のstylesheet_link_tagメソッドには2つの引数がある。
    * 最初の引数である文字列は、スタイルシートへのパスを示している。
        * 次の引数であるハッシュには2つの要素があり、最初の要素はメディアタイプを示し、
            次の要素はRails 4.0で追加されたturbolinksという機能をオンにしている。

* ハッシュがメソッド呼び出しの最後の引数である場合は、波カッコを省略できる

```
stylesheet_link_tag 'application', { media: 'all',
                                     'data-turbolinks-track': 'reload' }
```

